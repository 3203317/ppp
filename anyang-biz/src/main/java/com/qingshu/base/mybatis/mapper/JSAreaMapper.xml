<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="JSArea">
	<!-- Result Map -->
	<resultMap id="BaseResultMap" type="JSArea">
	<result column="id" property="id" />
	<association property="areaParent" column="areaParentId" javaType="JSArea" select="JSArea.findById"/>
	<collection property="childAreas" column="id" select="findChildAreas" ofType="JSArea" /> 
	</resultMap>
	
	<!-- 数据表字段列 -->
	<sql id="Base_Column_List">
		jsa.id,jsa.areaCode,jsa.areaNo,jsa.areaName,jsa.areaParentId,jsa.areaLevel
	</sql>
	
	<!-- 数据表名 -->
	<sql id="tablename"> j_s_area </sql>
	<sql id="tableasname"> j_s_area jsa</sql>
	
	<!-- where 条件 -->
	<sql id="where"> where 1=1 </sql>
	
	<!-- columnKey 主键 列名称 ,视图获取不到主键 需要设置 -->
	<sql id="columnKey"> and jsa.id=#{id} </sql>
	
	<sql id="andOther">
		<trim suffixOverrides=",">
			<if test="areaCode != null"> and jsa.areaCode = #{areaCode} </if>
			<if test="areaNo != null"> and jsa.areaNo = #{areaNo} </if>
			<if test="areaName != null"> and jsa.areaName = #{areaName} </if>
			<if test="areaParent != null">  and jsa.areaParentId = #{areaParent.id} </if>
			<if test="areaLevel !=null"> and jsa.areaLevel = #{areaLevel}</if>
		</trim>
	</sql>
	
	<sql id="page_where">
		<trim prefix="where" prefixOverrides="and | or ">
			 <if test="queryParams.areaName !=null">and jsa.areaName = #{queryParams.areaName}</if>
			 <if test="queryParams.areaPid !=null">and jsa.areaPid = #{queryParams.areaPid}</if>
			 <if test="queryParams.areaLevel !=null">and jsa.areaLevel = #{queryParams.areaLevel}</if>
		</trim>
	</sql>
	
	<!-- 保存对象 -->
	<insert id="save" parameterType="JSArea">
		insert into
		<include refid="tablename" />
		(id,areaName,areaParentId,areaCode,areaNo,areaLevel)
		values(#{id},#{areaName},#{areaParent.id},#{areaCode},#{areaNo},#{areaLevel})
	</insert>
	<!-- 更新对象 -->
	<update id="update" parameterType="JSArea">
		update 
		<include refid="tablename"/> 
		<trim prefix="set" suffixOverrides=",">
			<if test="areaName != null">areaName = #{areaName},</if>
			<if test="areaCode != null">areaCode = #{areaCode},</if>
			<if test="areaNo != null">areaNo = #{areaNo},</if>
			<if test="areaLevel != null">areaLevel = #{areaLevel},</if>
			<if test="areaParent != null">areaParentId = #{areaParent.id},</if>
		</trim>
		<where>id = #{id}</where>
	</update>
	
	
	<!--查找对象-->
	<select id="findById" resultMap="BaseResultMap" parameterType="String" >
		select 
		<include refid="Base_Column_List" />
		from 
		<include refid="tableasname"/>
		where jsa.id = #{id}
	</select>
	<!--查找对象-->
	<select id="findChildAreas" resultMap="BaseResultMap" parameterType="String" >
		select 
		<include refid="Base_Column_List" />
		from 
		<include refid="tableasname"/>
		where jsa.areaParentId = #{id}
	</select>
	<!--根据机构级别查找对象-->
	<select id="findAreaByLevel" resultMap="BaseResultMap" parameterType="map" >
		select 
		<include refid="Base_Column_List" />
		from 
		<include refid="tableasname"/>
		where jsa.areaLevel = #{areaLevel} order by jsa.areaCode
	</select>
	<!--根据机构级别查找对象-->
	<select id="findAllArea" resultMap="BaseResultMap" >
		select 
		<include refid="Base_Column_List" />
		from 
		<include refid="tableasname"/> order by areaCode
	</select>
	<!--根据机构ID查询机构编码-->
	<select id="findAreaCode" resultType="String" parameterType="String" >
		select 
		jsa.areaCode
		from 
		<include refid="tableasname"/>
		where jsa.id = #{id}
	</select>
	<!--批量删除-->
	<delete id="deleteAll">
		delete from 
		<include refid="tablename" />
		where id in
		<foreach item="item" collection="array" open="(" separator="," close=")">
			#{item}
		</foreach>
	</delete>
	<!-- 生成排序号 -->
	<select id="createCode" resultType="String" parameterType="string">
		SELECT MAX(jsa.areaCode)+1 from 
        <include refid="tableasname" /> 
         where jsa.areaParentId=#{areaParentId}
	</select>
	<!-- 查询,参数查询,Map -->
	<select id="selectByMap" parameterType="Map" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="tableasname" />
		<include refid="where" />
		<include refid="andOther" />
		 order by jsa.areaCode
	</select>
	
	<!-- 获取对象列表(分页)-->
	<select id="pagerList" parameterType="PagerInfo" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="tableasname" />
	</select>
</mapper>
